#!/bin/sh
# Generated by Chef for <%= node['fqdn'] %>
#
# Any local changes will be deleted.

if [ ! -x "$JAVA_HOME" ]; then
  JAVA_HOME="<%= node['java']['home'] %>"
fi

if [ ! -x "$JAVA_HOME" ]; then
  # GIVE UP
  echo "cannot figure out JAVA_HOME, so exiting."
  exit 1
fi

AGENT_HOME=<%= @install_dir %>
AGENT="$AGENT_HOME/machineagent.jar"

# Agent Options
# Uncomment and make available as needed
# -Dappdynamics.agent.applicationName   : application that the agent participates in
# -Dappdynamics.agent.logging.dir       : directory to put logs (agent "user" must have write permissions
# -Dmetric.http.listener=true | false   : open a kill port
# -Dmetric.http.listener.port			: the port to send kill messages

AGENT_OPTIONS=
#AGENT_OPTIONS="$AGENT_OPTIONS -Dappdynamics.agent.applicationName=<application-name>"
#AGENT_OPTIONS="$AGENT_OPTIONS -Dappdynamics.agent.logging.dir="
#AGENT_OPTIONS="$AGENT_OPTIONS -Dmetric.http.listener=true | false
#AGENT_OPTIONS="$AGENT_OPTIONS -Dmetric.http.listener.port=<port>"
# set in controller-info.xml AGENT_OPTIONS="$AGENT_OPTIONS -Dappdynamics.controller.hostName=<%= node['appdynamics']['controller']['host'] %>"
# set in controller-info.xml AGENT_OPTIONS="$AGENT_OPTIONS -Dappdynamics.controller.port=8090"

# this is not working.  Filed a ticket with AppDynamics (http://help.appdynamics.com/requests/4957) 
# AGENT_OPTIONS="$AGENT_OPTIONS -Dappdynamics.agent.logging.dir=<%= node['appdynamics']['machine_agent']['logdir'] %>"

#Consolidation Step - allows you to easily add or remove the agent
nohup $JAVA_HOME/bin/java $AGENT_OPTIONS -jar $AGENT &
